generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(cuid())
  email        String        @unique
  password     String
  name         String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  monitors     Monitor[]
  subscription Subscription?

  @@map("users")
}

model Subscription {
  id        String             @id @default(cuid())
  userId    String             @unique
  plan      Plan               @default(FREE)
  status    SubscriptionStatus @default(ACTIVE)
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  user      User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("subscriptions")
}

model Monitor {
  id          String         @id @default(cuid())
  userId      String
  name        String
  url         String
  checkType   MonitorType    @map("type")
  interval    Int
  isActive    Boolean        @default(true)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  timeout     Int            @default(30)
  status      IncidentStatus @default(UP)
  lastChecked DateTime?
  checks      Check[]
  incidents   Incident[]
  user        User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("monitors")
}

model Check {
  id           String   @id @default(cuid())
  monitorId    String
  status       String
  responseTime Int?
  statusCode   Int?
  checkedAt    DateTime @default(now())
  isUp         Boolean  @default(true)
  errorMessage String?
  monitor      Monitor  @relation(fields: [monitorId], references: [id], onDelete: Cascade)

  @@index([monitorId, checkedAt])
  @@map("checks")
}

model Incident {
  id          String         @id @default(cuid())
  monitorId   String
  severity    IncidentStatus
  startedAt   DateTime       @default(now())
  resolvedAt  DateTime?
  title       String         @default("Incident")
  description String?
  isResolved  Boolean        @default(false)
  monitor     Monitor        @relation(fields: [monitorId], references: [id], onDelete: Cascade)

  @@index([monitorId, startedAt])
  @@map("incidents")
}

enum Plan {
  FREE
  STARTER
  PRO
  BUSINESS
}

enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  PAST_DUE
}

enum MonitorType {
  HTTP
  HTTPS
  SSL
  DOMAIN
  PING
}

enum IncidentStatus {
  DOWN
  UP
  DEGRADED
}
